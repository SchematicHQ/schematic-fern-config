---
title: Customer Portal and Checkout Flow

slug: components/customer-portal
---

Schematic provides a customizable Customer Portal and checkout flow that allows your customers to easily complete common billing tasks like:
1. Purchasing a plan or add-on
2. Upgrading, downgrading, or canceling their subscription
3. View upcoming and past invoices
4. Check current usage and entitlements

This component integrates fully with Stripe and is intended to replace Stripe's native checkout flow. Schematic components will sync any changes to the subscription to Stripe.

Additionally, Schematic provides a component builder so the content and styling of the Customer Portal can be customized to match your use case and brand.

{/* This video is a quick walkthrough of how to setup a billing portal and the end-user experience of the billing portal.

!!!video example!!! */}

{/* ## Examples
I'd love to include a few screenshot or examples of the customer portal and checkout flow.
*/}

## Stripe Integration

Schematic Customer Portal handles the complete checkout flow for a new customer, upgrade, downgrade, or cancellation. This includes propogating the appropriate events to Stripe to handle payment and create/update the customer's subscription (these changes are also reflected in Schematic). If Stripe is connected, the Customer Portal will automatically interface with Stripe with no additional configuration required. To learn more about the Stripe integration, see the [Stripe Integration](/integrations/stripe) page. 

## Checkout Flow Events

After a customer completes a checks out flow (whether that's a new customer, upgrade, or downgrade), we post an event to the window that you can listen for. This event will include some key information, such as the `id` of the new plan. 

While not strictly necessary, we recommend performing a hard refresh of the page to ensure all flag checks and usage quotas are updated.

```javascript
window.addEventListener("plan-changed", (event) => {
  window.location.reload();
});
```

Additionally, if you want to act on the plan change, the event has a `detail` property that includes information about the new plan. Specifically, it will include

A few values below are numbers that represent dates (specifically, seconds since the Unix epoch). You can convert these to a `Date` object using by `new Date(value * 1000)`:

| Field | Type | Description |
| --- | --- | --- |
| cancelAt? | `Date?` | If the subscription cancelled, the date when the plan will cancel. |
| cancelAtPeriodEnd | `boolean` | `true` if this checkout represented a cancellation. `false` otherwise. |
| companyId? | `string?` | Schematic company ID |
| createdAt | `Date` | Date when the subscription started. |
| currency | `string` | Currency the user used for the subscription. |
| customerExternalId | `string` | Stripe customer ID for the company. |
| defaultPaymentMethodId | `string` | Default payment method ID for the customer. |
| expiredAt? | `Date?` | Date when the subscription will expire. |
| id | `string` | Schematic subscription ID. |
| interval | `string` | Interval of the subscription. Can be `month` or `year`. |
| metadata | `object` | Stripe metadata for the customer. |
| periodEnd | `number` | Date when the current billing period ends. |
| periodStart | `number` | Date when the current billing period starts. |
| status | `string` | Status of the subscription. Can be `active`, `canceled`, or `trialing`. |
| subscriptionExternalId | `string` | Stripe subscription ID. |
| totalPrice | `number` | The total price of the subscription in cents. (divide by 100 to get the price in $) |
| trialEnd? | `Date?` | If the subscription is a trial, the date when the trial will end. |
| trialEndSetting? | `string?` | If the subscription is a trial, the setting for when the trial will end. Can be `end_of_billing_period` or `end_of_trial`. |


{/*
i'd love to include a section about hosting react in angular and vue
*/}

{/* ## Common issues

### component busted

company has no plan, probably set default plan

### no "change plan" button

no live plans set, set live plans */}